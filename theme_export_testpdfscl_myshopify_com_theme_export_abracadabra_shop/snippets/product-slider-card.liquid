{%- comment -%}
  Reusable product card used by the product slider (mobile + desktop).
  Params:
    - p: product object (required)
    - mode: 'mobile' | 'desktop' (optional, default 'mobile')
{%- endcomment -%}

{%- assign _mode = mode | default: 'mobile' -%}
{%- if _mode == 'mobile' -%}
  {%- assign is_mobile = true -%}
{%- else -%}
  {%- assign is_mobile = false -%}
{%- endif -%}

<article
  class="h-full bg-white flex flex-col bg-gray-50 p-3 px-[16px] py-[35px]"
  data-product-id="{{ p.id }}"
  data-variant-id="{{ p.variants.first.id }}"
  data-url="/products/{{ p.handle }}"
>
  <div class="relative overflow-hidden">
    {%- assign img = p.featured_image | default: p.featured_media.preview_image | default: p.images.first -%}
    <a
      href="/products/{{ p.handle }}"
      class="flex items-center justify-center w-full h-full"
    >
      {%- if img -%}
        <img
          src="{{ img | image_url: width: 700 }}"
          width="{{ img.width | default: 700 }}"
          height="{{ img.height | default: 500 }}"
          loading="lazy"
          decoding="async"
          alt="{{ p.title }}"
          class="w-full h-full max-w-full max-h-full object-contain aspect-[16/9]"
        >
      {%- else -%}
        <img
          height="200"
          src="{{ 'default-logo.png' | asset_url }}"
          width="300"
          loading="lazy"
          decoding="async"
          alt="{{ p.title }}"
          class="w-full h-full max-w-full max-h-full object-contain aspect-[16/9]"
        >
      {%- endif -%}
    </a>
  </div>

  {%- assign variations = p.metafields.variations.variations.value -%}
  <div class="isolate grow flex flex-col mt-[16px] md:mt-[8px]">
    <h3 class="font-[700] text-brand leading-snug text-[18px]">
      <a href="/products/{{ p.handle }}" class="hover:underline focus:outline-none focus:ring-0">
        {{- p.title -}}
      </a>
    </h3>

    {%- if p.metafields.attributes.subtitle != blank -%}
      <p class="mt-[8px] text-[14px] md:text-[18px] text-[#2E2E2D]">
        {{ p.metafields.attributes.subtitle }}
      </p>
    {%- endif -%}

    <div class="mt-auto">
      {%- if variations -%}
        {%- for variation in variations -%}
          {%- if variation.settings.type == 'colorpicker' -%}
            <div class="mt-[20px] w-full flex gap-[14px] flex-wrap">
              {%- for option in variation.options -%}
                <span
                  class="inline-block w-[24px] h-[24px] rounded-full"
                  style="background-color: {% render 'color-code', color: option.value %};"
                  aria-hidden="true"
                ></span>
              {%- endfor -%}
            </div>
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      <div class="mt-[32px] border-t border-[#C2C2C2]"></div>

      <div class="pt-[32px]">
        <div class="flex items-center justify-between gap-4 min-h-[44px]">
          <div class="inline-flex items-center gap-1 text-[20px] md:text-[24px] font-[700]">
            <span>{% render 'formatted-price', price: p.price %}</span>
          </div>

          <div class="ml-auto sm:mt-0 flex items-center gap-2 shrink-0" data-no-card-nav>
            <form
              method="post"
              action="/cart/add"
              accept-charset="UTF-8"
              class="flex gap-[12px] items-center pointer-events-auto relative z-20 shrink-0"
              onsubmit="return handleCardATC(event, this)"
              data-no-card-nav
            >
              <input type="hidden" name="id" value="{{ p.variants.first.id }}">

              <button
                type="button"
                class="
                  favorite-btn grid place-items-center w-[32px] h-[30px] rounded-full
                  border border-[#647167] transition
                  focus:outline-none focus-visible:ring-2 focus-visible:ring-[#647167]
                "
                aria-label="Zu Favoriten hinzufÃ¼gen"
                data-product-id="{{ p.handle }}"
                data-no-card-nav
              >
                <svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9.246 13.6843C8.974 13.7719 8.526 13.7719 8.254 13.6843C5.934 12.9612 0.75 9.94494 0.75 4.83258C0.75 2.57584 2.742 0.75 5.198 0.75C6.654 0.75 7.942 1.3927 8.75 2.38596C9.558 1.3927 10.854 0.75 12.302 0.75C14.758 0.75 16.75 2.57584 16.75 4.83258C16.75 9.94494 11.566 12.9612 9.246 13.6843Z" stroke="#647167" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>

              <button
                type="submit"
                form="card-atc-{{ product.id }}"
                class="
                  icon-btn icon-add-to-cart grid place-items-center w-[32px] h-[32px] rounded-full
                  border border-[#647167] transition
                  hover:bg-[#ECECEC]
                  focus:outline-none focus-visible:ring-2 focus-visible:ring-[#647167]
                "
                aria-label="In den Warenkorb"
                data-no-card-nav
              >
                <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.75 0.75H1.72962C1.91414 0.75 2.00639 0.75 2.08064 0.78393C2.14606 0.813831 2.20151 0.861919 2.24036 0.922459C2.28445 0.991158 2.2975 1.08249 2.32359 1.26515L2.67857 3.75M2.67857 3.75L3.46749 9.54855C3.5676 10.2844 3.61766 10.6523 3.79357 10.9293C3.94858 11.1733 4.17081 11.3673 4.43352 11.488C4.73165 11.625 5.10296 11.625 5.84558 11.625H12.264C12.9709 11.625 13.3244 11.625 13.6132 11.4978C13.8679 11.3857 14.0864 11.2049 14.2442 10.9757C14.4232 10.7157 14.4893 10.3685 14.6216 9.67407L15.6143 4.46227C15.6609 4.21786 15.6842 4.09565 15.6504 4.00012C15.6208 3.91633 15.5624 3.84576 15.4857 3.80101C15.3981 3.75 15.2737 3.75 15.0249 3.75H2.67857ZM6.75 15C6.75 15.4142 6.41421 15.75 6 15.75C5.58579 15.75 5.25 15.4142 5.25 15C5.25 14.5858 5.58579 14.25 6 14.25C6.41421 14.25 6.75 14.5858 6.75 15ZM12.75 15C12.75 15.4142 12.4142 15.75 12 15.75C11.5858 15.75 11.25 15.4142 11.25 15C11.25 14.5858 11.5858 14.25 12 14.25C12.4142 14.25 12.75 14.5858 12.75 15Z" stroke="#647167" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</article>
